<!doctype html>
<html>
<head>
  <meta charset="utf-8" />
  <title>GDPR Compliance Map — Working Demo</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <!-- Leaflet CSS -->
  <link
    rel="stylesheet"
    href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css"
    crossorigin=""
  />
  <style>
    html, body {
      height: 100%;
      margin: 0;
      font-family: system-ui, Arial, sans-serif;
    }
    #app {
      display: flex;
      height: 100%;
      width: 100%;
    }
    #map {
      flex: 1;
      height: 100%;
    }
    #panel {
      width: 400px;
      border-left: 1px solid #ccc;
      padding: 10px;
      overflow-y: auto;
    }
    .jur-card {
      border: 1px solid #ddd;
      border-radius: 6px;
      padding: 8px;
      margin-bottom: 10px;
      background: #fafafa;
    }
    button {
      margin-top: 6px;
      padding: 6px 10px;
    }
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid #ddd;
      padding: 6px;
      font-size: 13px;
    }
  </style>
</head>
<body>
<div id="app">
  <div id="map"></div>
  <div id="panel">
    <h2>GDPR Compliance Map (Demo)</h2>
    <div id="details">Click a marker on the map.</div>
    <h3>Compare</h3>
    <div id="compareArea">No jurisdictions selected.</div>
  </div>
</div>

<!-- Leaflet JS -->
<script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js" crossorigin=""></script>
<script>
const catalogue = [
  { id:'fr', name:'France', coords:[46.7,2.5] },
  { id:'de', name:'Germany', coords:[51.1,10.4] },
  { id:'uk', name:'United Kingdom', coords:[54.4,-2.6] }
];

const dataStore = {
  'fr': {
    name:'France',
    authority:'CNIL',
    law:'GDPR + French Data Protection Act',
    transfers:'SCCs, adequacy applies.',
    fines:'Up to €20M or 4% global turnover.'
  },
  'de': {
    name:'Germany',
    authority:'BfDI / State DPAs',
    law:'GDPR + Federal Data Protection Act (BDSG).',
    transfers:'SCCs; special employment rules.',
    fines:'Up to €20M or 4% global turnover.'
  },
  'uk': {
    name:'United Kingdom',
    authority:'ICO',
    law:'UK GDPR + DPA 2018',
    transfers:'UK adequacy, SCCs.',
    fines:'Up to £17.5M or 4% turnover.'
  }
};

const map = L.map('map').setView([52.5, 9.5], 5);
L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
  attribution: '© OpenStreetMap contributors'
}).addTo(map);

catalogue.forEach(j => {
  const marker = L.circleMarker(j.coords, {radius:8, color:'#0077ff', fillColor:'#0077ff', fillOpacity:0.8});
  marker.addTo(map).bindTooltip(j.name);
  marker.on('click', () => showDetails(j.id));
});

const detailsEl = document.getElementById('details');
const compareEl = document.getElementById('compareArea');
const selected = [];

function showDetails(id) {
  const d = dataStore[id];
  detailsEl.innerHTML = `
    <div class="jur-card">
      <h3>${d.name}</h3>
      <p><strong>Supervisory Authority:</strong> ${d.authority}</p>
      <p><strong>Law:</strong> ${d.law}</p>
      <p><strong>Transfers:</strong> ${d.transfers}</p>
      <p><strong>Fines:</strong> ${d.fines}</p>
      <button onclick="addToCompare('${id}')">Add to Compare</button>
    </div>`;
}

function addToCompare(id) {
  if (!selected.includes(id)) selected.push(id);
  renderCompare();
}

function removeFromCompare(id) {
  const i = selected.indexOf(id);
  if (i !== -1) selected.splice(i,1);
  renderCompare();
}

function renderCompare() {
  if (selected.length === 0) {
    compareEl.textContent = 'No jurisdictions selected.';
    return;
  }
  let html = '<table><thead><tr><th>Field</th>';
  selected.forEach(id => html += `<th>${dataStore[id].name} <button onclick="removeFromCompare('${id}')">x</button></th>`);
  html += '</tr></thead><tbody>';
  const fields = ['authority','law','transfers','fines'];
  const labels = {authority:'Authority',law:'Law',transfers:'Transfers',fines:'Fines'};
  fields.forEach(f => {
    html += `<tr><td><strong>${labels[f]}</strong></td>`;
    selected.forEach(id => html += `<td>${dataStore[id][f]}</td>`);
    html += '</tr>';
  });
  html += '</tbody></table>';
  compareEl.innerHTML = html;
}
</script>
</body>
</html>

